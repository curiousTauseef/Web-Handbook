<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="style.css" type="text/css"></link>
    <script type="text/javascript" src="lib/paper-full.min.js"></script>
  </head>
  <body>
    <canvas id="paper_canvas" resize></canvas>
  </body>
  <script type="text/javascript">
    paper.setup(document.getElementById("paper_canvas"));

    var svg,
        svgItem,
        point = paper.Point,
        tool = new paper.Tool(),
        positionModifier = 1,
        faces = [];


    tool.onMouseDrag = function (event) {
      // console.log(event.point.subtract(event.downPoint).x);
      var amount = (event.point.subtract(event.downPoint)).x;
      positionModifier = amount/10;
    }
    paper.view.onFrame = function (event) {
      faces.forEach(function (f, i){
        f.children.forEach(function (c, ii){
          // console.log( c.data.originalX );
          // c.translate( new point( 1*i*ii*positionModifier, 1*i*ii*positionModifier ) );
          // c.translate( new point( c.originalX*i*ii*positionModifier, c.originalY*i*ii*positionModifier ) );
          c.position.x = c.data.originalX + i*ii*positionModifier;
          c.position.y = c.data.originalY + i*ii*positionModifier;
          c.rotate(positionModifier/10);
        });
      });
    }

    paper.project.importSVG("img/jc_photo.svg", onSvgLoad);

    function onSvgLoad(item) {
      var p;
      svgItem = item.children[0];
      // randomlyColorChildren(svgItem);
      createSmallMultiples(svgItem);
      svg = paper.project.exportSVG();
      p = document.createElement("p");
      p.innerText = paper.project.exportSVG({asString: true});

      // document.body.appendChild(svg);
      document.body.appendChild(p);
    }

    function createSmallMultiples(item) {
      for (var i=0; i<10; i++){
        var smallItem = item.clone().scale(0.5);
        smallItem.position.x += (i * 200);
        smallItem.children.forEach(function (c, ii){
          // console.log( "i = "+ i +", ii = "+ ii );
          // console.log( c.position.x );
          c.data.originalX = c.position.x;
          // console.log( c.data.originalX );
          c.data.originalY = c.position.y;
          // c.translate( getRandom( new paper.Point( 0, 0 ), new paper.Point( i*1, ii*1 ) ) );
          // c.translate( new point( 1*i*ii*positionModifier, 1*i*ii*positionModifier ) );
          // c.translate( new point( 1*i*ii*positionModifier, 1*i*ii*positionModifier ) );
        });
        randomlyColorChildren(smallItem);
        faces.push(smallItem);
      }
      item.remove();
    }

    function randomlyColorChildren(item) {
      var len = item.children.length,
          hueStep = 360.0 / len;
      item.children.forEach(function (c, i) {
        c.fillColor = {
          hue: hueStep * i,
          saturation: 1.0,
          brightness: 1.0
        };
      });
    }

    function getRandom(min, max) {
      return Math.random() * (max - min) + min;
    }
  </script>
</html>