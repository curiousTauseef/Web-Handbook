<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="style.css" type="text/css"></link>
    <script type="text/javascript" src="lib/paper-full.js"></script>
    <script type="text/x-paperscript" data-paper-canvas="myCanvas">
      function onResize(event) {
        path.position = view.center;
      }

      function randomColor(hueMin, hueMax, brightness) {
        var hueMin = hueMin || 0,
            hueMax = hueMax || 360
            brightness = brightness || 0.9;

        return new Color({
          hue: hueMin + Math.random() * (hueMax - hueMin),
          saturation: 1.0,
          brightness: brightness
        });
      }
      function mix(a, b, t) {
        return a + (b - a) * t;
      }

      // Create shapes by adding points together
      var path = new Path();
      path.strokeColor = randomColor(10, 60);
      path.dashArray = [4, 4];
      path.add([0, 30]);
      path.add([50, 60]);
      path.add([0, 90]);
      path.closed = true;
      path.scale(5.0);
      path.smooth();

      var followers = [];
      function addFollower(position) {
        var f = new Path.Circle(position, 8.0);
        f.fillColor = randomColor();
        f.time = 0.0;
        f.secondsPerLoop = mix(6.0, 0.5, position.x / view.size.width);
        console.log(f);
        followers.push(f);
      }

      function onMouseDown(event) {
        addFollower(event.point);
      }

      function onMouseDrag(event) {

      }

      function updatePath(dt) {
        path.segments[0].point.x += Math.cos(dt);
        path.segments[0].point.y += Math.sin(dt);

        path.segments[1].point.x += Math.cos(dt * 0.9);
        path.segments[1].point.y += Math.sin(dt * 0.9);
        path.smooth();
      }

      function onFrame(event) {
        updatePath(event.time);
        var len = path.length
        followers.forEach(function (f) {
          var vel = len / f.secondsPerLoop;
          f.time += event.delta * vel;
          if (f.time > len) {
            f.time -= len;
          }
          f.position = path.getPointAt(f.time);
        });
      }
    </script>
  </head>
  <body>
    <canvas id="myCanvas" resize></canvas>
  </body>
</html>